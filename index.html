<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Perceptrón Interactivo - Iteraciones</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f4f4f9; margin:0; padding:0; }
.container { max-width:900px; margin:30px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
h1 { text-align:center; color:#333; }
.tab { display:flex; justify-content:center; border-bottom:2px solid #ccc; margin-bottom:20px; }
.tab button { background:none; border:none; cursor:pointer; padding:10px 20px; font-size:16px; transition:0.3s; border-bottom:3px solid transparent; }
.tab button.active { border-bottom:3px solid #007BFF; color:#007BFF; font-weight:bold; }
.tabcontent { display:none; padding-top:10px; }
.controls { text-align:center; margin-bottom:15px; }
.controls label, .controls select, .controls input, .controls button { margin:5px; }
.plot-container { width:100%; height:600px; margin:0 auto; }
</style>
</head>
<body>

<div class="container">
<h1>Perceptrón Interactivo - Iteraciones</h1>

<div class="tab">
  <button class="tablinks" onclick="openDataset(event,'Dataset1')">Dataset 1</button>
  <button class="tablinks" onclick="openDataset(event,'Dataset2')">Dataset 2</button>
  <button class="tablinks" onclick="openDataset(event,'Dataset3')">Dataset 3</button>
  <button class="tablinks" onclick="openDataset(event,'Dataset4')">Dataset 4</button>
</div>

<!-- ==================== Dataset Template ==================== -->
<div id="Dataset1" class="tabcontent"></div>
<div id="Dataset2" class="tabcontent"></div>
<div id="Dataset3" class="tabcontent"></div>
<div id="Dataset4" class="tabcontent"></div>

<script>
// ===== Datos simulados de entrenamiento =====
const datasets = {
  "Dataset1": generateData(),
  "Dataset2": generateData(),
  "Dataset3": generateData(),
  "Dataset4": generateData()
};

// Función para generar estructura base de cada dataset
function generateData() {
  const X = [[1,2],[2,1],[3,3],[4,2],[2,0],[0,1]];
  const y = [1,1,1,-1,-1,-1];
  const pesos = [], sesgos = [], w_best = [], b_best = [], error_best = [];
  for(let sesgo=0; sesgo<2; sesgo++){
    pesos.push([]); sesgos.push([]); w_best.push([]); b_best.push([]); error_best.push([]);
    for(let lr=0; lr<3; lr++){
      pesos[sesgo].push([ [1,1],[2,1],[3,1] ]); // 3 iteraciones
      sesgos[sesgo].push(sesgo ? [0,0,0] : [-3,-4,-5]);
      w_best[sesgo].push([3,1]);
      b_best[sesgo].push(-5);
      error_best[sesgo].push(0.5);
    }
  }
  return {X,y,pesos,sesgos,w_best,b_best,error_best};
}

// ===== Render de controles y plot para cada dataset =====
for(const key in datasets){
  const container = document.getElementById(key);
  container.innerHTML = `
    <h2>${key}</h2>
    <div class="controls">
      <label><input type="checkbox" id="${key}_sesgo" checked onchange="updatePlot('${key}')"> Usar sesgo</label>
      <label>Learning Rate:
        <select id="${key}_lr" onchange="updatePlot('${key}')">
          <option value="0">LR 0.01</option>
          <option value="1">LR 0.05</option>
          <option value="2">LR 0.1</option>
        </select>
      </label>
      Iteración: <input type="range" id="${key}_slider" min="0" max="2" step="1" value="0" oninput="updatePlot('${key}')">
      <button onclick="showBest('${key}')">Mostrar Mejor Peso</button>
    </div>
    <div id="${key}_plot" class="plot-container"></div>
  `;
}

// ===== Pestañas =====
function openDataset(evt,datasetName){
  const tabcontent = document.getElementsByClassName("tabcontent");
  for(let i=0;i<tabcontent.length;i++) tabcontent[i].style.display="none";
  const tablinks = document.getElementsByClassName("tablinks");
  for(let i=0;i<tablinks.length;i++) tablinks[i].className=tablinks[i].className.replace(" active","");
  document.getElementById(datasetName).style.display="block";
  evt.currentTarget.className+=" active";
  updatePlot(datasetName);
}

// ===== Actualización del plot =====
function updatePlot(datasetName, showBestFlag=false){
  const data = datasets[datasetName];
  const usarSesgo = document.getElementById(datasetName+"_sesgo").checked ? 0 : 1;
  const lr_idx = parseInt(document.getElementById(datasetName+"_lr").value);
  const slider = document.getElementById(datasetName+"_slider");
  let iter = parseInt(slider.value);
  if(showBestFlag) iter = data.pesos[usarSesgo][lr_idx].length-1;

  const w = data.pesos[usarSesgo][lr_idx][iter];
  const b = data.sesgos[usarSesgo][lr_idx][iter];

  let traces = [];
  // Puntos
  traces.push({
    x: data.X.map(p=>p[0]),
    y: data.X.map(p=>p[1]),
    mode:"markers",
    marker:{color:data.y.map(v=>v==1?"blue":"red"), size:10},
    name:"Datos"
  });

  // Vector w
  traces.push({x:[0,w[0]], y:[0,w[1]], mode:"lines+markers", line:{color:"green",width:3}, name:"Vector w"});

  // Hiperplano
  const x_vals=[], y_vals=[];
  const xMin = Math.min(...data.X.map(p=>p[0]))-1;
  const xMax = Math.max(...data.X.map(p=>p[0]))+1;
  for(let i=xMin;i<=xMax;i+=0.1){ x_vals.push(i); y_vals.push(-(w[0]*i+b)/w[1]); }
  traces.push({x:x_vals, y:y_vals, mode:"lines", line:{color:"black", dash:"dash"}, name:"Hiperplano"});

  // Mejor peso
  if(showBestFlag){
    const w_best = data.w_best[usarSesgo][lr_idx];
    const b_best = data.b_best[usarSesgo][lr_idx];
    const error_best = data.error_best[usarSesgo][lr_idx];
    const x_best=[], y_best=[];
    for(let i=xMin;i<=xMax;i+=0.1){ x_best.push(i); y_best.push(-(w_best[0]*i+b_best)/w_best[1]); }
    traces.push({x:[0,w_best[0]], y:[0,w_best[1]], mode:"lines+markers", line:{color:"orange",width:4}, name:`Mejor w (Error=${error_best})`});
    traces.push({x:x_best, y:y_best, mode:"lines", line:{color:"orange", dash:"dot", width:4}, name:"Hiperplano mejor w"});
  }

  Plotly.newPlot(datasetName+"_plot", traces, {
    xaxis:{range:[xMin-1,xMax+1]}, yaxis:{range:[xMin-1,xMax+1]},
    width:800, height:600, title:datasetName
  });
}

// Botón Mejor Peso
function showBest(datasetName){ updatePlot(datasetName,true); }

// Abrir primera pestaña
document.addEventListener("DOMContentLoaded",()=>document.getElementsByClassName("tablinks")[0].click());
</script>

</div>
</body>
</html>
